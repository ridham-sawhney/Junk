const fs=require("fs"),{Builder:e,By:a,until:t,WebDriverWait:i}=require("selenium-webdriver"),moment=require("moment"),os=require("os"),path=require("path"),userHome=os.homedir(),downloadsPath=path.join(userHome,"Downloads"),folderName="SurveyTraces",folderPath=path.join(downloadsPath,folderName);fs.mkdir(folderPath,{recursive:!0},n=>{n?console.error("Error creating folder:",n):console.log(`Folder ${folderName} created successfully in the Downloads directory.`)});let returnData=[],returnDataElement={user:"",SurveyResults:[]};async function typeInUsername(n,r){return await n.wait(t.elementLocated(a.id("username")),2e4),await n.findElement(a.id("username")).sendKeys(r)}async function typeInPassword(n,r){return await n.wait(t.elementLocated(a.id("password")),2e4),await n.findElement(a.id("password")).sendKeys(r)}async function clickSignIn(n){return await n.findElement(a.id("chklgnbtn")).click()}async function clickSubmit(n){return await n.wait(t.elementLocated(a.className("blk-btn btn-fill survey-submit-btn")),2e4),await n.findElement(a.className("blk-btn btn-fill survey-submit-btn")).click()}async function clickClose(n){return await n.wait(t.elementLocated(a.className("btn-out survey-scs-cls")),2e4),await n.findElement(a.className("btn-out survey-scs-cls")).click()}async function waitLoadingToStop(n){return await n.wait(t.stalenessOf(n.findElement(a.css(".loader-text"))),2e4)}async function waitSurveyLoadingToStop(n){return await n.wait(async function(){return await n.executeScript('return window.getComputedStyle(arguments[0]).getPropertyValue("display") === "none"',element=await n.findElement(a.className("bg-blur")))},2e4,"Element did not become invisible within 10 seconds")}async function clickTakeSurvey(n){return await n.wait(t.elementLocated(a.className("card info-card survey-card")),2e4),await n.findElement(a.className("card info-card survey-card")).click()}async function logoutUser(n){return await n.wait(t.elementLocated(a.className("user")),2e4),await n.findElement(a.className("user")).click(),await n.wait(t.elementLocated(a.className("logout-btn")),2e4),await n.findElement(a.className("logout-btn")).click(),await n.wait(t.elementLocated(a.className("blk-btn btn-fill")),2e4),await n.findElement(a.className("blk-btn btn-fill")).click()}async function giveSurvey(n,r){var s=!1;try{s=await (await n.findElement(a.className("nosurd"))).isDisplayed()}catch(o){}if(s){log(`	Survey ${r} was already done.`),returnDataElement.SurveyResults.push(`Survey ${r} was already done.`);return}await n.wait(t.elementsLocated(a.css(".lisq")),2e4);let l=await n.findElements(a.css(".lisq"));for(let c of l){await n.executeScript("arguments[0].scrollIntoView(true)",c);let u=await c.findElements(a.css(".survey-option .radiobtn")),w=u[Math.floor(Math.random()*u.length)];await n.executeScript("arguments[0].scrollIntoView(true)",w),await w.click()}await clickSubmit(n),await n.sleep(1e3),await clickClose(n),returnDataElement.SurveyResults.push(`Survey ${r} done.`),log(`	Survey ${r} done.`)}function log(n,r=!1){let s=`${n}`;fs.writeFileSync(`${folderPath}/${moment().format("YYYY-MM-DD")}_Survey.txt`,s,{flag:r?"w":"a"}),console.info(n)}let cc=0;async function Work(n){console.log("Survey Started");let r;(r=await new e().forBrowser("chrome").build()).manage().window().maximize(),await r.get("https://curativesurvey.com/Userf/UserLogin"),await r.sleep(5e3),log(`[${moment().format("YYYY-MM-DD HH:mm:ss")}]########################`,!0);for(let s=0;s<n.length;s++){log(`-----------------------------`),log(`[User : ${n[s][0]}]`),(returnDataElement={user:"",SurveyResults:[]}).user=n[s][0];try{await typeInUsername(r,n[s][0]),await typeInPassword(r,n[s][1]),await clickSignIn(r),await waitLoadingToStop(r),await r.sleep(2e3),await clickTakeSurvey(r),await r.wait(t.elementsLocated(a.css("a[data-cid]")),2e4);let o=await r.findElements(a.css("a[data-cid]")),l=r.actions({async:!0});await r.executeScript("arguments[0].scrollIntoView();",o[0]),await l.move({origin:o[0]}).perform(),await o[0].click(),await waitSurveyLoadingToStop(r),await giveSurvey(r,1),await r.sleep(500),await r.executeScript("arguments[0].scrollIntoView();",o[1]),await l.move({origin:o[1]}).perform(),await o[1].click(),await waitSurveyLoadingToStop(r),await giveSurvey(r,2),await r.sleep(500),await r.executeScript("arguments[0].scrollIntoView();",o[2]),await l.move({origin:o[2]}).perform(),await o[2].click(),await waitSurveyLoadingToStop(r),await giveSurvey(r,3),await r.sleep(500),await r.executeScript("arguments[0].scrollIntoView();",o[3]),await l.move({origin:o[3]}).perform(),await o[3].click(),await waitSurveyLoadingToStop(r),await giveSurvey(r,4),await r.sleep(500),await r.executeScript("arguments[0].scrollIntoView();",o[4]),await l.move({origin:o[4]}).perform(),await o[4].click(),await waitSurveyLoadingToStop(r),await giveSurvey(r,5),await r.sleep(500),returnData.push(returnDataElement),await logoutUser(r)}catch(c){cc++,log("\n==================================\n"),log("#Error:\n"),log(c),log("\n==================================\n");for(let u=returnDataElement.SurveyResults.length;u<5;u++)returnDataElement.SurveyResults.push(`Survey ${u+1} failed , restart survey or do manually!!`);returnData.push(returnDataElement),await r.quit(),(r=await new e().forBrowser("chrome").build()).manage().window().maximize(),await r.get("https://curativesurvey.com/Userf/UserLogin"),await r.sleep(2500)}}await r.quit()}process.on("message",async n=>{console.log(n),await Work(n),process.send(returnData),process.exit()});